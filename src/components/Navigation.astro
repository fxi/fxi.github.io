---
const { currentPath } = Astro.props;

const navItems = [
  { href: '/about',        label: 'About' },
  { href: '/projects',     label: 'Projects' },
  { href: '/publications', label: 'Publications' },
  { href: '/photos',       label: 'Photos' },
  { href: '/posts',        label: 'Posts' },
];
---

<nav class="site-nav">
  {navItems.map(({ href, label }) => (
    <a
      href={href}
      class:list={['nav-link', currentPath.startsWith(href) && 'nav-link--active']}
    >
      {label}
    </a>
  ))}

  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle color theme" title="Toggle color theme">
    <!-- Sun (shown in light mode) -->
    <span class="icon icon-sun" aria-hidden="true">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <circle cx="12" cy="12" r="4.5"/>
        <line x1="12" y1="2"   x2="12" y2="4"/>
        <line x1="12" y1="20"  x2="12" y2="22"/>
        <line x1="2"  y1="12"  x2="4"  y2="12"/>
        <line x1="20" y1="12"  x2="22" y2="12"/>
        <line x1="4.93" y1="4.93"   x2="6.34" y2="6.34"/>
        <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"/>
        <line x1="4.93"  y1="19.07" x2="6.34"  y2="17.66"/>
        <line x1="17.66" y1="6.34"  x2="19.07" y2="4.93"/>
      </svg>
    </span>
    <!-- Moon (shown in dark mode) -->
    <span class="icon icon-moon" aria-hidden="true">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </span>
  </button>
</nav>

<script>
  function getActiveTheme(): 'light' | 'dark' {
    const attr = document.documentElement.getAttribute('data-theme');
    if (attr === 'light' || attr === 'dark') return attr;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  const btn = document.getElementById('theme-toggle');

  btn?.addEventListener('click', () => {
    const next = getActiveTheme() === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
  });

  // Keep in sync when OS preference changes (only if no explicit user override)
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
    }
  });
</script>
